# Статистические критерии - Руководство по использованию

Реализованы три основных статистических критерия на основе библиотеки Boost и методологии Агамирова:

1. **Критерий Граббса** - для выявления выбросов
2. **F-критерий Фишера** - для сравнения дисперсий двух выборок
3. **t-критерий Стьюдента** - для сравнения средних (два варианта)

---

## 1. Критерий Граббса (Grubbs' test)

### Назначение
Проверка выборки из нормального распределения на наличие одного выброса (аномального значения).

### Гипотезы
- **H₀**: подозрительное значение не является выбросом
- **H₁**: подозрительное значение является выбросом

### Статистика теста
```
G = max|xᵢ - x̄| / s
```
где:
- `x̄` - выборочное среднее
- `s` - выборочное стандартное отклонение

### Критическое значение (формула из Агамирова, раздел 3.2)
```
G_critical = ((n-1)/√n) × √(t²_{α/(2n), n-2} / (n - 2 + t²_{α/(2n), n-2}))
```

### Пример использования

```cpp
#include "statistical_tests.h"

std::vector<double> data = {98.5, 102.3, 95.7, 108.1, 101.2, 97.8, 103.5};

// Проверка максимального значения
GrubbsTestResult result_max = grubbs_test_max(data, 0.05);

// Проверка минимального значения
GrubbsTestResult result_min = grubbs_test_min(data, 0.05);

// Двусторонний тест (проверяет оба экстремума)
GrubbsTestResult result = grubbs_test(data, 0.05);

// Вывод результатов
print_grubbs_result(result, "output/grubbs_test.txt");

if (result.is_outlier) {
    std::cout << "Обнаружен выброс: x[" << result.outlier_index
              << "] = " << result.outlier_value << std::endl;
}
```

### Результаты теста
Структура `GrubbsTestResult`:
- `test_statistic` - значение статистики G
- `critical_value` - критическое значение G_critical
- `is_outlier` - true, если обнаружен выброс
- `outlier_value` - значение подозрительного наблюдения
- `outlier_index` - индекс в массиве данных
- `alpha` - уровень значимости
- `n` - размер выборки

---

## 2. F-критерий Фишера (Fisher's F-test)

### Назначение
Сравнение дисперсий двух независимых выборок из нормальных распределений.

### Гипотезы
- **H₀**: σ₁² = σ₂² (дисперсии равны)
- **H₁**: σ₁² ≠ σ₂² (дисперсии различаются)

### Статистика теста (формула 3.12 из Агамирова)
```
F = s₁² / s₂²  (где s₁² ≥ s₂²)
```

### Распределение под H₀
```
F ~ F(n₁-1, n₂-1)
```

### Пример использования

```cpp
#include "statistical_tests.h"

std::vector<double> sample1 = {98.5, 102.3, 95.7, 108.1, 101.2};
std::vector<double> sample2 = {97.8, 103.5, 99.4, 106.2, 94.3};

// Выполнение F-теста
FisherTestResult result = fisher_test(sample1, sample2, 0.05);

// Вывод результатов
print_fisher_result(result, "output/fisher_test.txt");

if (result.reject_h0) {
    std::cout << "Дисперсии различаются (p = " << result.p_value << ")" << std::endl;
} else {
    std::cout << "Дисперсии не различаются (p = " << result.p_value << ")" << std::endl;
}
```

### Результаты теста
Структура `FisherTestResult`:
- `f_statistic` - значение F-статистики
- `critical_value` - критическое значение F_{α/2, df₁, df₂}
- `p_value` - p-значение двустороннего теста
- `reject_h0` - true, если отвергаем H₀
- `var1`, `var2` - дисперсии выборок
- `n1`, `n2` - размеры выборок
- `df1`, `df2` - степени свободы

---

## 3. t-критерий Стьюдента (Student's t-test)

### 3.1 Классический t-критерий (для равных дисперсий)

#### Предположения
- Выборки независимы
- Обе выборки из нормальных распределений
- **σ₁² = σ₂²** (равные дисперсии)

#### Гипотезы
- **H₀**: μ₁ = μ₂ (средние равны)
- **H₁**: μ₁ ≠ μ₂ (средние различаются)

#### Статистика теста (формула 3.14 из Агамирова)
```
t = (x̄₁ - x̄₂) / (sp × √(1/n₁ + 1/n₂))
```

где объединенная дисперсия:
```
sp² = ((n₁-1)s₁² + (n₂-1)s₂²) / (n₁+n₂-2)
```

#### Распределение под H₀
```
t ~ Student(n₁ + n₂ - 2)
```

#### Пример использования

```cpp
#include "statistical_tests.h"

std::vector<double> sample1 = {98.5, 102.3, 95.7, 108.1, 101.2};
std::vector<double> sample2 = {97.8, 103.5, 99.4, 106.2, 94.3};

// t-критерий для равных дисперсий
StudentTestResult result = student_test_equal_var(sample1, sample2, 0.05);

// Вывод результатов
print_student_result(result, "output/student_test_equal_var.txt");

if (result.reject_h0) {
    std::cout << "Средние различаются (p = " << result.p_value << ")" << std::endl;
} else {
    std::cout << "Средние не различаются (p = " << result.p_value << ")" << std::endl;
}
```

---

### 3.2 Критерий Уэлча (для неравных дисперсий)

#### Предположения
- Выборки независимы
- Обе выборки из нормальных распределений
- **Дисперсии могут различаться** (σ₁² ≠ σ₂²)

#### Статистика теста (формула 3.16 из Агамирова)
```
t = (x̄₁ - x̄₂) / √(s₁²/n₁ + s₂²/n₂)
```

#### Степени свободы (приближение Уэлча-Саттертуэйта)
```
ν = (s₁²/n₁ + s₂²/n₂)² / ((s₁²/n₁)²/(n₁-1) + (s₂²/n₂)²/(n₂-1))
```

#### Пример использования

```cpp
#include "statistical_tests.h"

std::vector<double> sample1 = {98.5, 102.3, 95.7, 108.1, 101.2};
std::vector<double> sample2 = {97.8, 103.5, 99.4, 106.2, 94.3};

// t-критерий Уэлча для неравных дисперсий
StudentTestResult result = student_test_unequal_var(sample1, sample2, 0.05);

// Вывод результатов
print_student_result(result, "output/student_test_unequal_var.txt");
```

---

### 3.3 Автоматический выбор критерия

Функция `student_test_auto()` автоматически выбирает подходящий вариант t-критерия:
1. Сначала выполняет F-тест для проверки равенства дисперсий
2. Если дисперсии равны → использует классический t-критерий
3. Если дисперсии различаются → использует критерий Уэлча

#### Пример использования

```cpp
#include "statistical_tests.h"

std::vector<double> sample1 = {98.5, 102.3, 95.7, 108.1, 101.2};
std::vector<double> sample2 = {97.8, 103.5, 99.4, 106.2, 94.3};

// Автоматический выбор критерия
StudentTestResult result = student_test_auto(sample1, sample2, 0.05);

// Вывод результатов (включает информацию о F-тесте)
print_student_result(result, "output/student_test_auto.txt");
```

### Результаты теста
Структура `StudentTestResult`:
- `t_statistic` - значение t-статистики
- `critical_value` - критическое значение t_{α/2, ν}
- `p_value` - p-значение двустороннего теста
- `reject_h0` - true, если отвергаем H₀
- `mean1`, `mean2` - средние значения
- `std1`, `std2` - стандартные отклонения
- `n1`, `n2` - размеры выборок
- `df` - степени свободы (может быть дробным для Уэлча)
- `pooled_std` - объединенное СКО (только для равных дисперсий)
- `test_type` - "equal_var" или "unequal_var"

---

## Рекомендации по использованию

### Когда использовать критерий Граббса?
- Когда нужно проверить **одно наблюдение** на выброс
- Данные из **нормального распределения**
- Размер выборки: **n ≥ 3**

### Когда использовать F-критерий?
- Для **сравнения дисперсий** двух выборок
- Перед применением t-критерия (для выбора варианта)
- Данные из **нормальных распределений**

### Какой t-критерий выбрать?

```
┌─────────────────────────────────────┐
│ Нужно сравнить средние двух выборок │
└─────────────┬───────────────────────┘
              │
              ▼
    ┌──────────────────────┐
    │ Выполните F-тест     │
    │ для проверки дисперсий│
    └──────────┬───────────┘
               │
        ┌──────┴──────┐
        │             │
        ▼             ▼
  ┌─────────┐   ┌──────────┐
  │ σ₁² = σ₂²│   │ σ₁² ≠ σ₂² │
  └────┬────┘   └─────┬────┘
       │              │
       ▼              ▼
  ┌──────────────┐  ┌──────────────┐
  │ Классический │  │   Критерий   │
  │  t-критерий  │  │    Уэлча     │
  │  (equal_var) │  │ (unequal_var)│
  └──────────────┘  └──────────────┘
```

**Или просто используйте `student_test_auto()`** - она сделает выбор автоматически!

---

## Примеры вывода

### Критерий Граббса
```
========================================
  КРИТЕРИЙ ГРАББСА (Grubbs' test)
  для выявления выбросов
========================================

Тип теста: максимум
Размер выборки: n = 20
Уровень значимости: α = 0.05

Подозрительное значение: x[3] = 108.100000

Статистика G = 1.784462
Критическое значение G_critical = 2.708246

Гипотеза H0: значение не является выбросом
РЕЗУЛЬТАТ: H0 НЕ ОТВЕРГАЕТСЯ (выброс не обнаружен)
```

### F-критерий Фишера
```
========================================
  F-КРИТЕРИЙ ФИШЕРА (Fisher's F-test)
  для сравнения дисперсий
========================================

Размеры выборок: n₁ = 10, n₂ = 10
Степени свободы: df₁ = 9, df₂ = 9
Уровень значимости: α = 0.05

Дисперсия 1: s₁² = 19.617778
Дисперсия 2: s₂² = 12.567667

F-статистика = 1.560972
Критическое значение F_{0.975, 9, 9} = 4.025994
P-значение = 0.5176

РЕЗУЛЬТАТ: H0 НЕ ОТВЕРГАЕТСЯ (дисперсии не различаются)
```

### t-критерий Стьюдента
```
========================================
  t-КРИТЕРИЙ СТЬЮДЕНТА (Student's t-test)
  для сравнения средних
========================================

Метод: равные дисперсии (классический)
Размеры выборок: n₁ = 10, n₂ = 10
Степени свободы: ν = 18.00
Уровень значимости: α = 0.050

Среднее 1: x̄₁ = 100.700000
Среднее 2: x̄₂ = 101.490000
СКО 1: s₁ = 4.429196
СКО 2: s₂ = 3.545091
Объединенное СКО: sp = 4.011574

t-статистика = -0.440349
Критическое значение t_{0.975, 18.00} = 2.100922
P-значение = 0.6649

РЕЗУЛЬТАТ: H0 НЕ ОТВЕРГАЕТСЯ (средние не различаются)
```

---

## Файлы проекта

### Заголовочные файлы
- [include/statistical_tests.h](include/statistical_tests.h) - объявления функций и структур

### Исходные файлы
- [src/statistical_tests.cpp](src/statistical_tests.cpp) - реализация всех критериев

### Зависимости
- [include/boost_distributions.h](include/boost_distributions.h) - обертки для Boost.Math
- Библиотека **Boost.Math** для статистических распределений

---

## Компиляция и запуск

```bash
# Компиляция
make clean
make

# Запуск
./mle_estimator

# Результаты тестов сохраняются в output/
ls -lh output/*test*.txt
```

---

## Ссылки на литературу

Все формулы и методы реализованы согласно:
- **Агамиров Л.В.** "Математическая статистика. Статистическое оценивание параметров распределений"
  - Критерий Граббса: раздел 3.2, формулы 3.8-3.10
  - F-критерий Фишера: формула 3.12
  - t-критерий (равные дисперсии): формула 3.14
  - t-критерий (неравные дисперсии): формула 3.16

---

## Технические детали

### Использованные библиотеки Boost
- `boost::math::students_t` - распределение Стьюдента
- `boost::math::fisher_f` - распределение Фишера
- `boost::math::quantile()` - вычисление квантилей
- `boost::math::cdf()` - функция распределения

### Точность вычислений
- Все вычисления выполняются с типом `double` (IEEE 754)
- Критические значения вычисляются численно через Boost.Math
- P-значения вычисляются как двусторонние тесты

### Ограничения
- **Критерий Граббса**: требует n ≥ 3, данные из нормального распределения
- **F-критерий**: требует n₁ ≥ 2, n₂ ≥ 2, данные из нормальных распределений
- **t-критерий**: требует n₁ ≥ 2, n₂ ≥ 2, независимость выборок, нормальность
